Fix bug where CRLs with nextUpdate in the past are sometimes accepted
by initialising X509_STORE_CTX properly. (CVE-2011-3207)
[Kaspar Brand <ossl@velox.ch>]
diff -up openssl-1.0.0/crypto/x509/x509_vfy.c.crl-initialize openssl-1.0.0/crypto/x509/x509_vfy.c
--- openssl-1.0.0/crypto/x509/x509_vfy.c.crl-init	2009-11-17 14:25:35.000000000 +0100
+++ openssl-1.0.0/crypto/x509/x509_vfy.c	2011-09-12 15:02:12.000000000 +0200
@@ -703,6 +703,7 @@ static int check_cert(X509_STORE_CTX *ct
 	x = sk_X509_value(ctx->chain, cnum);
 	ctx->current_cert = x;
 	ctx->current_issuer = NULL;
+	ctx->current_crl_score = 0;
 	ctx->current_reasons = 0;
 	while (ctx->current_reasons != CRLDP_ALL_REASONS)
 		{
@@ -2015,6 +2016,9 @@ int X509_STORE_CTX_init(X509_STORE_CTX *
 	ctx->error_depth=0;
 	ctx->current_cert=NULL;
 	ctx->current_issuer=NULL;
+	ctx->current_crl=NULL;
+	ctx->current_crl_score=0;
+	ctx->current_reasons=0;
 	ctx->tree = NULL;
 	ctx->parent = NULL;
 
